# AMP Dockerfile for CPx on ARM 

FROM arm64v8/debian:12-slim

ENV AMP_CONTAINER=DOCKER
ENV LD_LIBRARY_PATH=./:/opt/cubecoders/amp/:/AMP/

RUN dpkg --add-architecture armhf &&\
 apt-get update &&\
 DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends\
 gnupg\
 locales\
 software-properties-common\
 libgcc-s1:armhf\
 libc++-dev\
 coreutils\
 inetutils-ping\
 iproute2\
 tmux\
 socat\
 unzip\
 wget\
 procps\
 libsqlite3-0\
 jq\
 git\
 git-lfs\
 curl\
 gdb\
 xz-utils\
 bzip2\
 libzstd1\
 libgdiplus\
 libc6\
 libc6-dev\
 libatomic1\
 libpulse-dev\
 liblua5.3-0\
 libstdc++6\
 zlib1g\
 libbz2-1.0:armhf\
 libcurl3-gnutls:armhf\
 libsdl2-2.0-0:armhf\
 xdg-user-dirs &&\
 apt-get clean &&\
 rm -rf /var/lib/apt/lists/* &&\
 localedef -i en_US -c -f UTF-8 -A /usr/share/locale/locale.alias en_US.UTF-8 &&\
 wget -q https://repo.cubecoders.com/aarch64/ampinstmgr-latest.tgz &&\
 tar -xf ampinstmgr-latest.tgz -C / &&\
 rm ampinstmgr-latest.tgz

ENV LANG=en_US.UTF-8
ENV LANGUAGE=en_US:en
ENV LC_ALL=en_US.UTF-8

RUN apt-get update &&\
 DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends\
 build-essential\
 cmake\
 git\
 gcc-arm-linux-gnueabihf\
 libgtk2.0-0:armhf\
 libsdl2-image-2.0-0:armhf &&\
 apt-get clean &&\
 rm -rf /var/lib/apt/lists/* &&\
 git clone https://github.com/ptitSeb/box86.git &&\
 cd box86 &&\
 mkdir build &&\
 cd build &&\
 cmake .. -DARM64=1 -DCMAKE_BUILD_TYPE=RelWithDebInfo &&\
 make -j$(nproc) &&\
 make install &&\
 git clone https://github.com/ptitSeb/box64.git &&\
 cd box64 &&\
 mkdir build &&\
 cd build &&\
 cmake .. -DCMAKE_BUILD_TYPE=RelWithDebInfo &&\
 make -j$(nproc) &&\
 make install

COPY ampstart.sh /

ENTRYPOINT ["/ampstart.sh"]
CMD []
